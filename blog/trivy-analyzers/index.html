<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=false><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="#FFFFFF"><title>Trivy, Go's init(), and the Magic of Dynamic Analyzer Discovery &#183; sneaky-potato</title><meta name=title content="Trivy, Go's init(), and the Magic of Dynamic Analyzer Discovery &#183; sneaky-potato"><script type=text/javascript src=https://sneaky-potato.github.io/js/appearance.min.8a082f81b27f3cb2ee528df0b0bdc39787034cf2cc34d4669fbc9977c929023c.js integrity="sha256-iggvgbJ/PLLuUo3wsL3Dl4cDTPLMNNRmn7yZd8kpAjw="></script><link type=text/css rel=stylesheet href=https://sneaky-potato.github.io/css/main.bundle.min.a645f3fa02b2ca20e7ef61b236048d95cc9bc2e5b2faf1f0ac0aa85431187c1c.css integrity="sha256-pkXz+gKyyiDn72GyNgSNlcybwuWy+vHwrAqoVDEYfBw="><script defer type=text/javascript id=script-bundle src=https://sneaky-potato.github.io/js/main.bundle.min.0b250a079f6c2f7d0e03d1f0aa1308acb88137e3caebe1268f7478f0c87c5bf8.js integrity="sha256-CyUKB59sL30OA9HwqhMIrLiBN+PK6+Emj3R48Mh8W/g=" data-copy=Copy data-copied=Copied></script><meta name=description content="
      go, open-source, design-patterns
    "><link rel=canonical href=https://sneaky-potato.github.io/blog/trivy-analyzers/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:url" content="https://sneaky-potato.github.io/blog/trivy-analyzers/"><meta property="og:site_name" content="sneaky-potato"><meta property="og:title" content="Trivy, Go's init(), and the Magic of Dynamic Analyzer Discovery"><meta property="og:description" content="go, open-source, design-patterns"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2025-10-07T00:00:00+00:00"><meta property="article:modified_time" content="2025-10-07T00:00:00+00:00"><meta property="article:tag" content="Life"><meta name=twitter:card content="summary"><meta name=twitter:title content="Trivy, Go's init(), and the Magic of Dynamic Analyzer Discovery"><meta name=twitter:description content="go, open-source, design-patterns"><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","articleSection":"Blog","name":"Trivy, Go\u0027s init(), and the Magic of Dynamic Analyzer Discovery","headline":"Trivy, Go\u0027s init(), and the Magic of Dynamic Analyzer Discovery","description":"go, open-source, design-patterns","inLanguage":"en","url":"https:\/\/sneaky-potato.github.io\/blog\/trivy-analyzers\/","author":{"@type":"Person","name":"Ashwani Kumar Kamal"},"copyrightYear":"2025","dateCreated":"2025-10-07T00:00:00\u002b00:00","datePublished":"2025-10-07T00:00:00\u002b00:00","dateModified":"2025-10-07T00:00:00\u002b00:00","keywords":["life"],"mainEntityOfPage":"true","wordCount":"867"}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://sneaky-potato.github.io/","name":"Sneaky Potato","position":1},{"@type":"ListItem","item":"https://sneaky-potato.github.io/blog/","name":"Blog","position":2},{"@type":"ListItem","name":"Trivy, Go's Init(), and the Magic of Dynamic Analyzer Discovery","position":3}]}</script><meta name=author content="Ashwani Kumar Kamal"><link href=mailto:sneakypotato.hello@gmail.com rel=me><link href=https://www.facebook.com/ashwani.k.kamal/ rel=me><link href=https://www.instagram.com/sneaky_potato/ rel=me><link href=https://github.com/sneaky-potato rel=me><link href=https://www.linkedin.com/in/ashwani-k-kamal/ rel=me><link href=https://snapchat.com/add/sneaky-potatoo rel=me><link href=https://stackoverflow.com/users/19008681/ashwani-kumar-kamal rel=me></head><body class="m-auto flex h-screen max-w-7xl flex-col bg-neutral px-6 text-lg leading-7 text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32"><div id=the-top class="absolute flex self-center"><a class="-translate-y-8 rounded-b-lg bg-primary-200 px-3 py-1 text-sm focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="pe-2 font-bold text-primary-600 dark:text-primary-400">&darr;</span>Skip to main content</a></div><header class="py-6 font-semibold text-neutral-900 dark:text-neutral sm:py-10 print:hidden"><nav class="flex items-start justify-between sm:items-center"><div class="flex flex-row items-center"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" rel=me href=/>sneaky-potato</a></div><ul class="flex list-none flex-col text-end sm:flex-row"><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><a href=/about/ title=About><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">About</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><a href=/blog/ title=Blog><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Blog</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><a href=/til/ title="Today I Learned"><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">TIL</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><a href=https://github.com/jpanther/congo title target=_blank><span class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0"><button id=search-button-m0 title="Search (/)">
<span class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"><span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></span></button></li></ul></nav></header><div class="relative flex grow flex-col"><main id=main-content class=grow><article><header class=max-w-prose><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class="hidden inline"><a class="dark:underline-neutral-600 decoration-neutral-300 hover:underline" href=https://sneaky-potato.github.io/>sneaky-potato</a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="dark:underline-neutral-600 decoration-neutral-300 hover:underline" href=https://sneaky-potato.github.io/blog/>Blog</a><span class="px-1 text-primary-500">/</span></li><li class="hidden inline"><a class="dark:underline-neutral-600 decoration-neutral-300 hover:underline" href=https://sneaky-potato.github.io/blog/trivy-analyzers/>Trivy, Go's init(), and the Magic of Dynamic Analyzer Discovery</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mb-8 mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Trivy, Go's init(), and the Magic of Dynamic Analyzer Discovery</h1><div class="mb-10 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2025-10-07 00:00:00 +0000 UTC">7 October 2025</time><span class="px-2 text-primary-500">&#183;</span><span>867 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">5 mins</span><span class="px-2 text-primary-500">&#183;</span>
<span class=mb-[2px]><a href=# class="text-lg hover:text-primary-500" rel="noopener noreferrer" target=_blank title="Edit content"><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M490.3 40.4c21.9 21.87 21.9 57.33.0 79.2l-30 30.1-98-97.98 30.1-30.06C414.3-.2135 449.7-.2135 471.6 21.66L490.3 40.4zM172.4 241.7 339.7 74.34l98 97.96L270.3 339.6C264.2 345.8 256.7 350.4 248.4 353.2l-88.8 29.6C150.1 385.6 141.5 383.4 135 376.1 128.6 370.5 126.4 361 129.2 352.4l29.6-88.8C161.6 255.3 166.2 247.8 172.4 241.7v0zM192 63.1c17.7.0 32 15.23 32 32 0 18.6-14.3 32-32 32H96c-17.67.0-32 15.2-32 32V416c0 17.7 14.33 32 32 32H352c17.7.0 32-14.3 32-32V319.1c0-16.8 14.3-32 32-32s32 15.2 32 32V416c0 53-43 96-96 96H96c-53.02.0-96-43-96-96V159.1c0-53 42.98-96 96-96h96z"/></svg></span></a></span></div></div></header><section class="prose mt-0 flex max-w-full flex-col dark:prose-invert lg:flex-row"><div class="order-first px-0 lg:order-last lg:max-w-xs lg:ps-8"><div class="toc pe-5 lg:sticky lg:top-10 print:hidden"><details open class="-ms-5 mt-0 overflow-hidden rounded-lg ps-5"><summary class="block cursor-pointer bg-neutral-100 py-1 ps-5 text-lg font-semibold text-neutral-800 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="border-s border-dotted border-neutral-300 py-2 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#what>What?</a></li><li><a href=#what-is-trivy>What is trivy?</a></li><li><a href=#issue>Issue</a></li><li><a href=#solution>Solution</a></li><li><a href=#go-and-trivy>Go and trivy</a><ul><li><a href=#but-how-does-trivy-call-the-right-analyzer-for-the-right-file>But how does trivy call the right analyzer for the right file?</a></li><li><a href=#dynamic-discovery-via-import-side-effect>Dynamic discovery via import side effect</a></li></ul></li><li><a href=#go-init-as-a-plugin-hook>Go init() as a &ldquo;Plugin Hook&rdquo;</a><ul><li><a href=#why-this-is-cool>Why This is Cool</a></li></ul></li><li><a href=#summary>Summary</a></li></ul></nav></div></details></div></div><div class="min-h-0 min-w-0 max-w-prose grow"><div class="lead !mb-9 text-xl">How Trivy Dynamically Discovers New File Format Analyzers in Go</div><h2 id=what class="relative group">What? <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#what aria-label=Anchor>#</a></span></h2><p>I want to discuss a particular design pattern in go through a <a href=https://github.com/aquasecurity/trivy/pull/8897 target=_blank rel=noreferrer>PR</a> which I raised in the open source project <a href=https://github.com/aquasecurity/trivy target=_blank rel=noreferrer>trivy</a></p><h2 id=what-is-trivy class="relative group">What is trivy? <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#what-is-trivy aria-label=Anchor>#</a></span></h2><p><a href=https://trivy.dev target=_blank rel=noreferrer>Trivy</a> is an open source vulnerability scanner. You could use Trivy to find vulnerabilities (CVE) & misconfigurations (IaC) across code repositories, binary artifacts, container images, Kubernetes clusters, and more.</p><p>Since it is open source it used in extensively in build and deploy pipelines across projects. I used trivy in my build pipelines to scan images, configuration, licenses and most importantly - <strong>vulnerabilities</strong> in the source code.</p><p>And when I got to know that trivy is written in go, I realized I could make a meaningful open source contribution in the <a href=https://github.com/aquasecurity/trivy target=_blank rel=noreferrer>repository</a>. I want to talk about a design pattern used in trivy and how I contributed to add support for another file format in it.</p><h2 id=issue class="relative group">Issue <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#issue aria-label=Anchor>#</a></span></h2><p>So I found this relevant issue while inspecting the repository on Github: <a href=https://github.com/aquasecurity/trivy/issues/8307 target=_blank rel=noreferrer>feat(nodejs): Bun support</a>. The issue talks about adding support for <a href=https://bun.sh/blog/bun-lock-text-lockfile target=_blank rel=noreferrer>bun lockfile</a>.
For those who do not know, <a href=https://bun.sh/ target=_blank rel=noreferrer>bun</a> is a new javascript runtime, much like node, but faster. It comes with its own lock file <em>bun.lock</em> much like <em>package.json</em> as in the case with node projects.</p><p>Now bun.lock file has a structure and the issue talked about adding support for scanning this particular file only. You see, trivy already had the support for major file formats related to npm and node, but users wanted support for <strong>bun.lock</strong> file as well.</p><h2 id=solution class="relative group">Solution <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#solution aria-label=Anchor>#</a></span></h2><p>The maintainers helped a lot, gave me pointers and solved my doubts while implementing the solution for this issue. I want to point out a certain nuance that trivy uses to analyze different file formats and how it was so easy to add support for yet another file format to it.</p><p>I raised 2 pull requests for this change, first I implemented a prerequisite <a href=https://github.com/aquasecurity/trivy/pull/8851/files target=_blank rel=noreferrer>parser</a> and then an <a href=https://github.com/aquasecurity/trivy/pull/8897 target=_blank rel=noreferrer>analyzer for bun.lock</a>
I want you to look at the second PR.</p><h2 id=go-and-trivy class="relative group">Go and trivy <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#go-and-trivy aria-label=Anchor>#</a></span></h2><p>You see Trivy scans many file types:</p><ul><li>package-lock.json (npm)</li><li>Pipfile.lock (Python)</li><li>poetry.toml (Python)
And more…</li></ul><p>Each format requires a different analyzer. You can look at the file <a href=https://github.com/aquasecurity/trivy/pull/8897/files#diff-56193d94f68a465ac3eb687e19688481e7411394179e2e2d78fd68211b2b8d5c target=_blank rel=noreferrer>pkg/fanal/analyzer/language/nodejs/bun/bun.go</a>
where I wrote an analyzer for <code>bun.lock</code> files. The package basically has the following important components:</p><ul><li>init function</li><li>bunLibraryAnalyzer struct</li><li>PostAnalyze method</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=nf>init</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>analyzer</span><span class=p>.</span><span class=nf>RegisterPostAnalyzer</span><span class=p>(</span><span class=nx>analyzer</span><span class=p>.</span><span class=nx>TypeBun</span><span class=p>,</span><span class=w> </span><span class=nx>newBunLibraryAnalyzer</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>type</span><span class=w> </span><span class=nx>bunLibraryAnalyzer</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>logger</span><span class=w>        </span><span class=o>*</span><span class=nx>log</span><span class=p>.</span><span class=nx>Logger</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>lockParser</span><span class=w>    </span><span class=nx>language</span><span class=p>.</span><span class=nx>Parser</span><span class=w> </span><span class=c1>// generic type definition for the parser</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>packageParser</span><span class=w> </span><span class=o>*</span><span class=nx>packagejson</span><span class=p>.</span><span class=nx>Parser</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>func</span><span class=w> </span><span class=nf>newBunLibraryAnalyzer</span><span class=p>(</span><span class=nx>_</span><span class=w> </span><span class=nx>analyzer</span><span class=p>.</span><span class=nx>AnalyzerOptions</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>analyzer</span><span class=p>.</span><span class=nx>PostAnalyzer</span><span class=p>,</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>bunLibraryAnalyzer</span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=nx>logger</span><span class=p>:</span><span class=w>        </span><span class=nx>log</span><span class=p>.</span><span class=nf>WithPrefix</span><span class=p>(</span><span class=s>&#34;bun&#34;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=nx>lockParser</span><span class=p>:</span><span class=w>    </span><span class=nx>bun</span><span class=p>.</span><span class=nf>NewParser</span><span class=p>(),</span><span class=w> </span><span class=c1>// specific type definition while constructing</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=nx>packageParser</span><span class=p>:</span><span class=w> </span><span class=nx>packagejson</span><span class=p>.</span><span class=nf>NewParser</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>},</span><span class=w> </span><span class=kc>nil</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>a</span><span class=w> </span><span class=nx>bunLibraryAnalyzer</span><span class=p>)</span><span class=w> </span><span class=nf>PostAnalyze</span><span class=p>(</span><span class=nx>_</span><span class=w> </span><span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span><span class=w> </span><span class=nx>input</span><span class=w> </span><span class=nx>analyzer</span><span class=p>.</span><span class=nx>PostAnalysisInput</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=nx>analyzer</span><span class=p>.</span><span class=nx>AnalysisResult</span><span class=p>,</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// ... a long implementation of the analyzer specific to bun.lock file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Such implementations are present for different file formats as well.</p><h3 id=but-how-does-trivy-call-the-right-analyzer-for-the-right-file class="relative group">But how does trivy call the right analyzer for the right file? <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#but-how-does-trivy-call-the-right-analyzer-for-the-right-file aria-label=Anchor>#</a></span></h3><p>If Trivy had to manually list every analyzer in a central switch statement, adding a new analyzer would require touching the core code every time.</p><p>This violates the Open/Closed Principle: software should be open for extension, closed for modification</p><p>This is where Trivy employs the go&rsquo;s <code>init()</code> function.</p><blockquote><p>In go, every package can define one or more init() functions:</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nx>bun</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=s>&#34;fmt&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>func</span><span class=w> </span><span class=nf>init</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Bun analyzer initialized&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Key points about <code>init()</code>:</p><ul><li>Called automatically once per package before main() starts</li><li>Useful for initialization logic that should run without explicit calls</li><li>Can be used to register types, plug-ins, or handlers dynamically</li></ul><p>Think of it as Go&rsquo;s &ldquo;automatic constructor for a package.&rdquo;</p><h3 id=dynamic-discovery-via-import-side-effect class="relative group">Dynamic discovery via import side effect <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#dynamic-discovery-via-import-side-effect aria-label=Anchor>#</a></span></h3><p>Trivy has a file pkg/fanal/analyzer/all/import.go:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>_</span><span class=w> </span><span class=s>&#34;github.com/aquasecurity/trivy/pkg/fanal/analyzer/language/nodejs/npm&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>_</span><span class=w> </span><span class=s>&#34;github.com/aquasecurity/trivy/pkg/fanal/analyzer/language/nodejs/bun&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><p>If you look at <a href=https://github.com/aquasecurity/trivy/pull/8897/files#diff-8d2e69ce6143d1b1e019dae4cc7952170076c578519082c130d801eec95a9aea target=_blank rel=noreferrer>pkg/fanal/analyzer/all/import.go</a> file, this is where we import ALL the analyzers which are implemented in the trivy code base.</p><ul><li><code>_</code> means import for side effects only</li><li>go will import the package, run its <code>init()</code>, and then discard the package name</li><li>The side effect is that the analyzer registers itself in the global registry</li></ul><p>So by just adding an import here, your new analyzer is discovered automatically.</p><h2 id=go-init-as-a-plugin-hook class="relative group">Go init() as a &ldquo;Plugin Hook&rdquo; <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#go-init-as-a-plugin-hook aria-label=Anchor>#</a></span></h2><p>Imagine every analyzer has a self-registration hook. Go automatically calls these hooks when the program starts. The core logic just says:</p><p>&ldquo;Hey analyzers, tell me which files you can handle.&rdquo;</p><p>This is essentially a plugin discovery system powered by <code>init()</code>.</p><h3 id=why-this-is-cool class="relative group">Why This is Cool <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#why-this-is-cool aria-label=Anchor>#</a></span></h3><ul><li>Open/Closed Principle: add new analyzers without touching core code</li><li>Decoupled architecture: core logic doesn&rsquo;t care about specific analyzers</li><li>Plug-and-play: Only requirement is importing the package</li></ul><h2 id=summary class="relative group">Summary <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#summary aria-label=Anchor>#</a></span></h2><p>Trivy&rsquo;s plugin/analyzer system is conceptually closer to virtual functions and inheritance than to the classical Visitor pattern.
In Trivy, each analyzer (like package-lock.json, Pipfile.lock, bun.lock) is a module that implements a common interface, something like:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span><span class=w> </span><span class=nx>Analyzer</span><span class=w> </span><span class=kd>interface</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nf>Analyze</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span><span class=w> </span><span class=nx>input</span><span class=w> </span><span class=nx>analyzer</span><span class=p>.</span><span class=nx>Input</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=nx>analyzer</span><span class=p>.</span><span class=nx>Result</span><span class=p>,</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nf>Required</span><span class=p>(</span><span class=nx>filePath</span><span class=w> </span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>info</span><span class=w> </span><span class=nx>os</span><span class=p>.</span><span class=nx>FileInfo</span><span class=p>)</span><span class=w> </span><span class=kt>bool</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Each analyzer:</p><ul><li>Implements these methods (like overriding virtual functions).</li><li>Calls <code>analyzer.RegisterAnalyzer()</code> inside its <code>init()</code> to register itself with the global registry.</li></ul><p>So the spirit is identical:</p><blockquote><p>Define a common interface; allow many implementations; dispatch at runtime.</p></blockquote><p>The only difference is how the compiler/runtime achieves the polymorphism:</p><ul><li>Go uses interface type assertions (duck typing).</li><li>C++ uses vtables and virtual calls.</li></ul></div></section><footer class="max-w-prose pt-8 print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="group flex" href=https://sneaky-potato.github.io/blog/elf/><span class="me-2 text-neutral-700 transition-transform group-hover:-translate-x-[2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"><span class="ltr:inline rtl:hidden">&larr;</span><span class="ltr:hidden rtl:inline">&rarr;</span></span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Staring inside programs: ELF</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2025-09-03 00:00:00 +0000 UTC">3 September 2025</time>
</span></span></a></span><span></span></div></div><div class=pt-3><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class=pt-3><script src=https://utteranc.es/client.js repo=sneaky-potato/sneaky-potato.github.io issue-term=pathname label=comment theme=github-dark-orange crossorigin=anonymous async></script></div></div></footer></article></main><div class="pointer-events-none absolute bottom-0 end-0 top-[100vh] w-12" id=to-top hidden=true><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div><footer class="py-10 print:hidden"><nav class="pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400"><ul class="flex list-none flex-col sm:flex-row"><li class="group mb-1 text-end sm:mb-0 sm:me-7 sm:last:me-0"><a href=/tags/ title=Tags><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Tags</span></a></li></ul></nav><div class="flex items-center justify-between"><div><p class="text-sm text-neutral-500 dark:text-neutral-400">Copy, <em>right?</em> (▀̿Ĺ̯▀̿ ̿)</p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://github.com/jpanther/congo target=_blank rel="noopener noreferrer">Congo</a></p></div><div class="flex flex-row items-center"><div class="me-14 cursor-pointer text-sm text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"><button id=appearance-switcher-0 type=button aria-label="appearance switcher"><div class="flex h-12 w-12 items-center justify-center dark:hidden" title="Switch to dark appearance"><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="hidden h-12 w-12 items-center justify-center dark:flex" title="Switch to light appearance"><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div></div></footer><div id=search-wrapper class="invisible fixed inset-0 z-50 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]" data-url=https://sneaky-potato.github.io/><div id=search-modal class="top-20 mx-auto flex min-h-0 w-full max-w-3xl flex-col rounded-md border border-neutral-200 bg-neutral shadow-lg dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex flex-none items-center justify-between px-2"><form class="flex min-w-0 flex-auto items-center"><div class="flex h-8 w-8 items-center justify-center text-neutral-400"><span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="mx-1 flex h-12 flex-auto appearance-none bg-transparent focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex h-8 w-8 items-center justify-center text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto overflow-auto px-2"><ul id=search-results></ul></section></div></div></div></body></html>