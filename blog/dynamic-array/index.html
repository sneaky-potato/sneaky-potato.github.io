<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=content-type content="text/html"><meta name=viewport content="width=device-width,initial-scale=1"><title itemprop=name>Dynamics of a dynamic array | Potato</title><meta property="og:title" content="Dynamics of a dynamic array | Potato"><meta name=twitter:title content="Dynamics of a dynamic array | Potato"><meta itemprop=name content="Dynamics of a dynamic array | Potato"><meta name=application-name content="Dynamics of a dynamic array | Potato"><meta property="og:site_name" content="Awesome hugo blog"><meta name=description content="memory, fibonacci, phi"><meta itemprop=description content="memory, fibonacci, phi"><meta property="og:description" content="memory, fibonacci, phi"><meta name=twitter:description content="memory, fibonacci, phi"><meta property="og:locale" content="en-us"><meta name=language content="en-us"><link rel=alternate hreflang=en href=https://sneaky-potato.github.io/blog/dynamic-array/ title><meta name=generator content="Hugo 0.152.1"><meta property="og:url" content="https://sneaky-potato.github.io/blog/dynamic-array/"><meta property="og:site_name" content="Potato"><meta property="og:title" content="Dynamics of a dynamic array"><meta property="og:description" content="memory, fibonacci, phi"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2025-03-06T00:00:00+00:00"><meta property="article:modified_time" content="2025-03-06T00:00:00+00:00"><meta property="article:tag" content="Life"><meta name=twitter:card content="summary"><meta name=twitter:title content="Dynamics of a dynamic array"><meta name=twitter:description content="memory, fibonacci, phi"><link rel=canonical href=https://sneaky-potato.github.io/blog/dynamic-array/><link href=/style.min.2d921c18cf1ec555ffc03d59a8adc211c402c68c930c27d6a0c306ab175a8d09.css rel=stylesheet><link href=/code-highlight.min.706d31975fec544a864cb7f0d847a73ea55ca1df91bf495fd12a177138d807cf.css rel=stylesheet><link rel=apple-touch-icon sizes=180x180 href=/icons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/icons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/icons/favicon-16x16.png><link rel=mask-icon href=/icons/safari-pinned-tab.svg><link rel="shortcut icon" href=/favicon.ico><link rel=manifest href=https://sneaky-potato.github.io/site.webmanifest><meta name=msapplication-config content="/browserconfig.xml"><meta name=msapplication-TileColor content="#2d89ef"><meta name=theme-color content="#434648"><link rel=icon type=image/svg+xml href=/icons/favicon.svg><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity="sha512-fHwaWebuwA7NSF5Qg/af4UeDx9XqUpYpOGgubo3yWu+b2IQR4UeQwbb42Ti7gVAjNtVoI/I9TEoYeu9omwcC6g==" crossorigin=anonymous crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity="sha512-LQNxIMR5rXv7o+b1l8+N1EZMfhG7iFZ9HhnbJkTp4zjNr5Wvst75AqUeFDxeRUa7l5vEDyUiAip//r+EFLLCyA==" crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity="sha512-iWiuBS5nt6r60fCz26Nd0Zqe0nbk1ZTIQbl3Kv7kYsX+yKMUFHzjaH2+AnM6vp2Xs+gNmaBAVWJjSmuPw76Efg==" crossorigin=anonymous onload='renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})'></script></head><body data-theme=dark class=notransition><script src=/js/theme.min.8961c317c5b88b953fe27525839672c9343f1058ab044696ca225656c8ba2ab0.js integrity="sha256-iWHDF8W4i5U/4nUlg5ZyyTQ/EFirBEaWyiJWVsi6KrA="></script><div class=navbar role=navigation><nav class=menu aria-label="Main Navigation"><a href=https://sneaky-potato.github.io/ class=logo><svg width="25" height="25" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home"><title/><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
</a><input type=checkbox id=menu-trigger class=menu-trigger>
<label for=menu-trigger><span class=menu-icon><svg width="25" height="25" stroke="currentColor" fill="none" viewBox="0 0 14 14"><title>Menu</title><path stroke-linecap="round" stroke-linejoin="round" d="M10.595 7H3.40726"/><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 3.51488H3.49301"/><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 10.4851H3.49301"/><path stroke-linecap="round" stroke-linejoin="round" d="M.5 12.5V1.5c0-.552285.447715-1 1-1h11C13.0523.5 13.5.947715 13.5 1.5v11C13.5 13.0523 13.0523 13.5 12.5 13.5H1.5C.947715 13.5.5 13.0523.5 12.5z"/></svg></span></label><div class=trigger><ul class=trigger-container><li><a class=menu-link href=/>Home</a></li><li><a class="menu-link active" href=/blog/>Blog</a></li><li><a class=menu-link href=/about/>About</a></li><li><a class=menu-link href=/cv.pdf>CV</a></li><li class=menu-separator><span>|</span></li></ul><a id=mode href=#><svg class="mode-sunny" width="21" height="21" viewBox="0 0 14 14" stroke-width="1"><title>LIGHT</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1=".5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1=".5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/></g></svg>
<svg class="mode-moon" width="21" height="21" viewBox="0 0 14 14" stroke-width="1"><title>DARK</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1=".5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1=".5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/></g></svg></a></div></nav></div><div class="wrapper post"><main class=page-content aria-label=Content><article><header class=header><h1 class=header-title>Dynamics of a dynamic array</h1><div class=post-meta><time datetime=2025-03-06T00:00:00+00:00 itemprop=datePublished>Mar 6, 2025</time></div></header><div class=page-content><div class="lead !mb-9 text-xl">Memory and this beauty: $(\varphi = \dfrac{1+\sqrt5}{2}= 1.6180339887â€¦$)</div><h2 id=changing-sizes>Changing sizes</h2><p>If you do programming you would be familiar with the likes of <code>std::vector&lt;></code> or <code>ArrayList&lt;></code> or <code>slices</code>. These are examples of dynamic array.
These are arrays which can change their size during runtime. On the contrary we have static arrays which have their size defined and cannot be changed dynamically.
A natural question is how do these structures grow in size when elements are appended to them?</p><p>Consider the following terms:</p><ul><li>size: logical length of the array</li><li>capacity: the maximum logical length of the array</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>int</span> arr[<span style=color:#ae81ff>256</span>]; <span style=color:#75715e>// a static array of capacity 256 is defined
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>arr[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;   <span style=color:#75715e>// size of the array is 2 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>arr[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;   <span style=color:#75715e>// as only 2 meaningful elements are inserted
</span></span></span></code></pre></div><p>The approach used for appending elements goes like this in case of dynamic arrays-</p><ul><li>use a static array</li><li><em>grow</em> the array in size when inserting a new element makes size >= capacity</li><li>this is done by creating a new array of larger capacity and copying the older array in this new memory location</li><li>the older array is then deleted and this new larer array can be used for further appends</li><li>but the question is, how large this new array should be?</li></ul><p>The below code snippet shows the approach used with <strong>doubling</strong> the array when required-</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>function <span style=color:#a6e22e>insertEnd</span>(dynarray a, element e)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (a.size <span style=color:#f92672>==</span> a.capacity)
</span></span><span style=display:flex><span>        <span style=color:#75715e>// notice the capacity is doubled here
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        a.capacity <span style=color:#f92672>=</span> a.capacity <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span> 
</span></span><span style=display:flex><span>        <span style=color:#75715e>// (copy the contents to the new memory location here)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    a[a.size] <span style=color:#f92672>=</span> e       <span style=color:#75715e>// assign e to last index
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    a.size <span style=color:#f92672>=</span> a.size <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span> <span style=color:#75715e>// increase size
</span></span></span></code></pre></div><h2 id=growth-factor>Growth Factor</h2><p>Notice in the above code snippet, array capacity gets <strong>doubled</strong> each time we need more size, this is called the <strong>growth factor</strong>.
Now to answer, what should be optimal growth factor for this operation? We first need to define the cost of the operation for this question to make sense.
To understand this, let&rsquo;s take a look at what values existing systems use (thanks wikipedia<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>)</p><table><thead><tr><th>Implementation</th><th>Growth Factor</th></tr></thead><tbody><tr><td>Java <code>ArrayList</code></td><td>1.5</td></tr><tr><td>Python <code>PyListObject</code></td><td>~1.125 (n + (n &#187; 3))</td></tr><tr><td>G++ 5.2.0</td><td>2</td></tr><tr><td>Facebook folly/FBVector</td><td>1.5</td></tr><tr><td>Go slices</td><td>between 1.25 and 2</td></tr></tbody></table><p>The folly/FBVector<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> describes why growth factor of 2 is not good:</p><p>Say the size of array is $(S$), capacity $(C$) and growth factor $(f$)</p><ul><li>first reallocation, a new array of capacity $(f*C$) is created while the old memory of size $(C$) is marked obsolete</li><li>second reallocation, a new array of capacity $(f*f*C$) is created while older memory of size $(C + f*C$) is marked obsolete</li><li>since arrays are contiguous we are constrained to only take contiguous sections in the memory</li></ul><p>This creates the following series of memory-
$$
C, C*f, C*f^2, C*f^3, &mldr;
$$</p><p>Say $(f = 2$), this presents the following series-
$$
C, 2C, 4C, 8C, &mldr;
$$</p><p>Here every element in the series will be strictly larger than the sum of all previous ones because of the remarkable equality:
$$
C + 2C + 4C + 8C + &mldr; + 2^nC = (2^{n+1} - 1)C &lt; 2^{n+1}C
$$</p><p>So this means new array is of size $(2^{n+1}C$) and cannot use the obsolete marked memory because it is of size $((2^{n+1}-1)C$), hence a growth factor less than 2 is preferred.</p><p>This can also be demonstrated by taking some real values, say growth factor is 1.5, and we start with 16 byte array allocation</p><ul><li>Start with 16 bytes</li><li>When you need more, allocate 24 bytes, then free up the 16, leaving a 16-byte hole</li><li>When you need more, allocate 36 bytes, then free up the 24, leaving a 40-byte hole</li><li>When you need more, allocate 54 bytes, then free up the 36, leaving a 76-byte hole</li><li>When you need more, allocate 81 bytes, then free up the 54, leaving a 130-byte hole</li><li>When you need more, use 122 bytes (rounding up) from the 130-byte hole</li><li>This will not be possible with a growth factor of 2, your array will be forced to crawl forward in memory and will not be able to use free-ed up memory.</li></ul><h2 id=optimal-growth-factor>Optimal Growth Factor</h2><p>For optimality, we need to use the free-ed space efficiently, or as soon as possible.
This will happen after the second reallocation<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup> if and only if obsolete memory size is big enough to contian new memory
$$
C + f*C >= f*f*C
$$
The $(C$) factor can be cancelled out here and we are presented with a familiar quadratic inequality
$$
1 + f >= f^2
$$
$$
f^2 - f - 1 &lt;= 0
$$
$$
f &lt;= \varphi = \frac{1 + \sqrt{5}} {2}
$$</p><p>And yes the golden ratio just made its way in this problem as well. This reminds of a very beautiful visual shown in Numberphile<sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup> using golden ratio.</p><p>Since golden ratio is defined as $(\lim_{n\to\infty}\frac{T_{n}}{T_{n-1}}$) where $(T_n$) is the nth fibonacci number,
so this means to grow the array as fibonacci numbers grow.</p><h2 id=real-life-solution>Real life solution</h2><p>In reality after the nth allocation we would have the following memory chunks-</p><p>$$
C, fC, f^2C, f^3C, &mldr;, f^{n-1}C, f^{n}C
$$</p><p>The current array occupies the space $(f^{n-1}C$), new space is $(f^{n}C$) and we have $(C+fC+f^2C+f^3C+&mldr;+f^{n-2}C$) free space.
We want to fit the new array in older free memory, this means solving-
$$
C+fC+f^2C+f^3C+&mldr;+f^{n-2}C >= f^nC
$$</p><p>$$
\frac{f^{n-1}-1}{f-1} >= f^n
$$</p><p>$$
f^{n-1}-1 >= f^{n+1} - f^n
$$</p><p>For very large n $(f^{n-1}$) dominates 1 so this can be written as the above quadratic giving golden ratio as the ideal factor. However for small n, a value slightly less than $(\varphi$) works, which is often taken as 1.5</p><p>I wrote this whole page because <a href="https://www.youtube.com/watch?v=GZPqDvG615k">this</a> video popped in my youtube feed.</p><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share; fullscreen" loading=eager referrerpolicy=strict-origin-when-cross-origin src="https://www.youtube.com/embed/GZPqDvG615k?autoplay=0&amp;controls=1&amp;end=0&amp;loop=0&amp;mute=0&amp;start=0" style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 title="YouTube video"></iframe></div><p>Very interesting insights which I have not mentioned in this post.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=https://en.wikipedia.org/wiki/Dynamic_array>Dynamic Array - Wikipedia</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p><a href=https://github.com/facebook/folly/blob/main/folly/docs/FBVector.md>Facebook folly/FBVector</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p><a href=https://web.archive.org/web/20150806162750/http://www.gahcep.com/cpp-internals-stl-vector-part-1/>cpp-internals-stl-vector</a>&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4><p><a href="https://www.youtube.com/watch?v=sj8Sg8qnjOg">The Golden Ratio (why it is so irrational) - Numberphile</a>&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div></article><script src=https://utteranc.es/client.js repo=sneaky-potato/sneaky-potato.github.io issue-term=pathname label=comment theme=github-dark-orange crossorigin=anonymous async></script></main></div><footer class=footer><span class=footer_item></span>&nbsp;<div class=footer_social-icons><a href=https://github.com/sneaky-potato target=_blank rel="noopener noreferrer me" title=Github><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></div><small class=footer_copyright>Â© 2025 Ashwani Kumar Kamal.</small></footer><a href=# title id=totop><svg width="48" height="48" fill="currentColor" stroke="currentColor" viewBox="0 96 960 960"><path d="M283 704.739 234.261 656 480 410.261 725.739 656 677 704.739l-197-197-197 197z"/></svg>
</a><script src=https://sneaky-potato.github.io/js/main.min.35f435a5d8eac613c52daa28d8af544a4512337d3e95236e4a4978417b8dcb2f.js integrity="sha256-NfQ1pdjqxhPFLaoo2K9USkUSM30+lSNuSkl4QXuNyy8="></script></body></html>